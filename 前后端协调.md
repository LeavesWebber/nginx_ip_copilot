# 1. API 接口规范
前端定义的接口基本遵循 RESTful 风格，后端应保持一致：
```
POST   /api/auth/login           # 用户登录
POST   /api/auth/logout          # 用户登出
GET    /api/auth/info            # 获取当前用户信息
```

Nginx配置相关接口

```
GET    /api/nginx/config         # 获取当前配置
POST   /api/nginx/config/path    # 设置nginx配置文件路径
POST   /api/nginx/reload         # 重新加载nginx配置
GET    /api/nginx/status         # 获取nginx运行状态
GET    /api/nginx/backups        # 获取配置备份列表
POST   /api/nginx/backups/restore/{backup_id}  # 恢复指定备份
```

IP规则管理接口

```
GET    /api/ip-rules            # 获取所有IP规则
POST   /api/ip-rules            # 添加新的IP规则
DELETE /api/ip-rules/{rule_id}  # 删除指定IP规则
PUT    /api/ip-rules/{rule_id}  # 修改指定IP规则
POST   /api/ip-rules/batch      # 批量添加IP规则
DELETE /api/ip-rules/batch      # 批量删除IP规则
```

地理位置规则接口

```
GET    /api/geo-rules           # 获取所有地理位置规则
POST   /api/geo-rules           # 添加新的地理位置规则
DELETE /api/geo-rules/{rule_id} # 删除指定地理位置规则
PUT    /api/geo-rules/{rule_id} # 修改指定地理位置规则
```

AbuseIPDB相关接口

```
POST   /api/abuseipdb/enable    # 启用AbuseIPDB功能
POST   /api/abuseipdb/disable   # 禁用AbuseIPDB功能
GET    /api/abuseipdb/status    # 获取AbuseIPDB功能状态
GET    /api/abuseipdb/blacklist # 获取当前AbuseIPDB黑名单
```

系统管理接口

```
GET    /api/system/logs         # 获取操作日志
GET    /api/system/stats        # 获取系统统计信息
```

关键注意事项：
- 使用标准 HTTP 方法：GET、POST、PUT、DELETE
- URL 命名采用 kebab-case（如 ip-rules 而不是 ipRules）
- 资源路径使用复数形式（如 /api/ip-rules 而不是 /api/ip-rule）

# 2. 数据结构规范
数据结构格式：
```json
{
  "ip_rules": [
    {
      "id": "rule_001",
      "ip": "1.2.3.4",
      "type": "single_ip",
      "comment": "手动添加的封禁IP",
      "created_at": "2024-03-20T10:00:00Z",
      "status": "active"
    },
    {
      "id": "rule_002",
      "ip_range": "192.168.1.0/24",
      "type": "ip_range",
      "comment": "封禁整个子网",
      "created_at": "2024-03-20T10:00:00Z",
      "status": "active"
    }
  ],
  "geo_rules": [
    {
      "id": "geo_001",
      "country_code": "XX",
      "comment": "封禁某个国家",
      "created_at": "2024-03-20T10:00:00Z",
      "status": "active"
    }
  ]
}
```
关键注意事项：
- 字段命名采用 snake_case
- 时间格式统一使用 ISO 8601（如 2024-03-20T10:00:00Z）
- 布尔值字段使用 is_ 前缀（如 is_enabled）
- 状态字段使用枚举字符串（如 status: "active"）

# 3. 响应格式规范
根据前端 Mock 数据的实现：

```typescript
// Auth APIs
mock.onPost('/auth/login').reply((config) => {
  const { username, password } = JSON.parse(config.data)
  if (username === 'admin' && password === 'admin') {
    return [200, { token: 'mock-token-123' }]
  }
  return [401, { message: 'Invalid credentials' }]
})
```
后端应返回统一的响应格式：
```json
{
  "code": 200,          // HTTP 状态码
  "data": {},          // 具体数据
  "message": "success" // 提示信息
}
```

# 4. 认证机制
前端相关认证代码如下：
```typescript
import { login, logout } from '../../api'

interface AuthState {
  token: string | null
  user: any | null
}

export default {
  namespaced: true,
  
  state: (): AuthState => ({
    token: localStorage.getItem('token'),
    user: null
  }),

  mutations: {
    SET_TOKEN(state: AuthState, token: string) {
      state.token = token
      localStorage.setItem('token', token)
    },
    CLEAR_TOKEN(state: AuthState) {
      state.token = null
      localStorage.removeItem('token')
    }
  },

  actions: {
    async login({ commit }, credentials) {
      const { data } = await login(credentials)
      commit('SET_TOKEN', data.token)
      return data
    },
    async logout({ commit }) {
      await logout()
      commit('CLEAR_TOKEN')
    }
  }
}
```
关键注意事项：
- 使用 JWT token 进行身份验证
- token 通过 Authorization header 传递
- 登录成功返回 token
- 需要实现 token 过期机制

# 5. 错误处理
后端应返回统一的错误处理格式：
```json
{
  "code": 400,
  "message": "错误描述",
  "errors": [
    {
      "field": "字段名",
      "message": "具体错误"
    }
  ]
}
```

# 6. 配置文件管理
根据前端设置页面的实现：
```typescript
import { getSettings, updateSettings } from '../../api'

interface SettingsState {
  nginxConfigPath: string
  enableAbuseIPDB: boolean
  abuseIPDBApiKey: string
}

export default {
  namespaced: true,
  
  state: (): SettingsState => ({
    nginxConfigPath: '',
    enableAbuseIPDB: false,
    abuseIPDBApiKey: ''
  }),

  mutations: {
    SET_SETTINGS(state: SettingsState, settings: Partial<SettingsState>) {
      Object.assign(state, settings)
    }
  },

  actions: {
    async fetchSettings({ commit }) {
      const { data } = await getSettings()
      commit('SET_SETTINGS', data)
      return data
    },
    async saveSettings({ commit }, settings) {
      await updateSettings(settings)
      commit('SET_SETTINGS', settings)
    }
  }
}
```

关键注意事项：
- 配置文件路径验证和权限检查
- 配置文件备份机制
- 配置修改后的 Nginx 重载机制


# 7. 实时状态更新
前端 Dashboard 相关代码：
```typescript
import { getNginxStatus, reloadNginx } from '../../api'

interface NginxState {
  status: any | null
  config: string
}

export default {
  namespaced: true,
  
  state: (): NginxState => ({
    status: null,
    config: ''
  }),

  mutations: {
    SET_STATUS(state: NginxState, status: any) {
      state.status = status
    },
    UPDATE_CONFIG(state: NginxState, config: string) {
      state.config = config
    }
  },

  actions: {
    async getStatus({ commit }) {
      const { data } = await getNginxStatus()
      commit('SET_STATUS', data)
      commit('UPDATE_CONFIG', data.config)
      return data
    },
    async reload() {
      await reloadNginx()
    },
    async updateStatus({ commit }) {
      const response = await getNginxStatus()
      commit('SET_STATUS', response.data)
      commit('UPDATE_CONFIG', response.data.config)
    }
  }
}
```

关键注意事项：
- 使用 WebSocket 实现实时状态更新
- 后端应提供相应的 WebSocket 接口
- 前端应正确处理 WebSocket 连接和断开
- 提供配置修改后的即时反馈


